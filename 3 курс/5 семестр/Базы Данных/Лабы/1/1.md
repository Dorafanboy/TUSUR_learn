CREATE TABLE T_Address(
ID SERIAL PRIMARY KEY UNIQUE,
Post_code VARCHAR(6) CHECK(post_code SIMILAR TO '\d{6}'),
Region VARCHAR(30) NOT NULL,
City VARCHAR(30) NOT NULL,
Street VARCHAR(50) NOT NULL,
House INTEGER CHECK(House > 0),
Apartment INTEGER CHECK(Apartment > 0 OR NULL)
);




CREATE TABLE T_Pod(
ID SERIAL PRIMARY KEY UNIQUE,
FIO VARCHAR(85) NOT NULL,
IDAddr INTEGER REFERENCES t_address(ID)
);



CREATE TABLE T_Subs(
IDPod INTEGER REFERENCES t_pod(ID),
DateStart DATE NOT NULL,
IDPub VARCHAR(6) NOT NULL,
IDPeriod INTEGER NOT NULL,
PRIMARY KEY(IDPod, IDPub, IDPeriod)
);



CREATE TABLE T_Publishing(
ID VARCHAR(6) PRIMARY KEY CHECK(ID SIMILAR TO '\d{5}[1-9]'),
IDPubHouse VARCHAR(7),
PubName VARCHAR(50) NOT NULL,
Description text
);



CREATE TABLE T_Period(
IDPub VARCHAR(6) REFERENCES t_publishing(id),
PeriodName VARCHAR(20) NOT NULL,
Period INTEGER CHECK(Period > 0),
Price MONEY,
PRIMARY KEY(IDPub, Period)
);



CREATE TABLE T_PubHouse(
ID VARCHAR(7) PRIMARY KEY CHECK(ID SIMILAR TO '\d{2,7}'),
Name VARCHAR(50) NOT NULL,
IDAddr INTEGER REFERENCES t_address(id),
Phone VARCHAR(15) CHECK(Phone SIMILAR TO '\(\d{4}\) \d{2}-\d{2}-\d{2}')
);


ALTER TABLE t_subs
ADD FOREIGN KEY(IDPub, IDPeriod) REFERENCES t_period(idpub, period);


ALTER TABLE t_publishing
ADD CONSTRAINT idpubhouse FOREIGN KEY(idpubhouse) REFERENCES t_pubhouse(id);





 
                                          Таблица "public.t_address"
  Столбец  |         Тип          | Правило сортировки | Допустимость NULL |             По умолчанию
-----------+----------------------+--------------------+-------------------+---------------------------------------
 id        | integer              |                    | not null          | nextval('t_address_id_seq'::regclass)
 post_code | character varying(6) |                    |                   |
 region    | character(30)        |                    | not null          |
 city      | character(30)        |                    | not null          |
 street    | character(50)        |                    | not null          |
 house     | integer              |                    |                   |
 apartment | integer              |                    |                   |
Индексы:
    "t_address_pkey" PRIMARY KEY, btree (id)
Ограничения-проверки:
    "t_address_apartment_check" CHECK (apartment > 0 OR NULL::boolean)
    "t_address_house_check" CHECK (house > 0)
Ссылки извне:
    TABLE "t_pod" CONSTRAINT "t_pod_idaddr_fkey" FOREIGN KEY (idaddr) REFERENCES t_address(id)
    TABLE "t_pubhouse" CONSTRAINT "t_pubhouse_idaddr_fkey" FOREIGN KEY (idaddr) REFERENCES t_address(id)




                                        Таблица "public.t_pod"
 Столбец |      Тип      | Правило сортировки | Допустимость NULL |           По умолчанию
---------+---------------+--------------------+-------------------+-----------------------------------
 id      | integer       |                    | not null          | nextval('t_pod_id_seq'::regclass)
 fio     | character(85) |                    | not null          |
 idaddr  | integer       |                    |                   |
Индексы:
    "t_pod_pkey" PRIMARY KEY, btree (id)
Ограничения внешнего ключа:
    "t_pod_idaddr_fkey" FOREIGN KEY (idaddr) REFERENCES t_address(id)
Ссылки извне:
    TABLE "t_subs" CONSTRAINT "t_subs_idpod_fkey" FOREIGN KEY (idpod) REFERENCES t_pod(id)






INSERT INTO t_address(post_code, region, city, street, house, apartment) VALUES('634045', 'Томская Область', 'Томск', 'Нахимова', 20, 52);

INSERT INTO t_address(post_code, region, city, street, house, apartment) VALUES('634043', 'Томская Область', 'Томск', 'Вершинина', 74, 438);

INSERT INTO t_pubhouse(id, name, idaddr, phone) VALUES('29402', 'Habr', 1, '(8322) 20-28-10');


INSERT INTO t_publishing(id, idpubhouse, pubname, description) VALUES('000854', '29402', 'Habr', 'This is a portal about programming!');


INSERT INTO t_period(idpub, periodname, period, price) VALUES('000854', 'Премиум', 12, 1990);


INSERT INTO t_pod(fio, idaddr) VALUES('Иван Иванович', 2);

INSERT INTO t_subs(idpod, datestart,idpub, idperiod) VALUES(1, '2020-10-10', '000854', 12);


INSERT INTO t_subs(idpod, datestart,idpub, idperiod) VALUES(1, '2020-10-10', '000854', 12);

 id | post_code |             region             |              city              |                       street                       | house | apartment
----+-----------+--------------------------------+--------------------------------+----------------------------------------------------+-------+-----------
  1 | 634045    | Томская Область                | Томск                          | Нахимова                                           |    20 |        52
  2 | 634043    | Томская Область                | Томск                          | Вершинина                                          |    74 |       438
(2 строки)

~




